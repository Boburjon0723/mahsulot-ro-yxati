<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahsulot Ro'yxati</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background: #f5f5f5;
        }

        .language-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 1000;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .lang-btn {
            padding: 6px 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            border-color: #4CAF50;
        }

        .lang-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 12px;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        input[type="text"], input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .image-upload {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .image-upload input[type="file"] {
            flex: 1;
        }

        .image-preview {
            width: 60px;
            height: 60px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .colors-section {
            margin-bottom: 10px;
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .color-checkbox {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-checkbox:hover {
            border-color: #4CAF50;
        }

        .color-checkbox input[type="checkbox"] {
            margin-right: 8px;
        }

        .color-checkbox.selected {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }

        .quantities-section {
            display: none;
            margin-top: 10px;
        }

        .quantities-section.active {
            display: block;
        }

        .quantity-input {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .quantity-input .color-indicator {
            width: 25px;
            height: 25px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }

        .quantity-input input {
            flex: 1;
            padding: 6px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-add {
            background: #4CAF50;
            color: white;
            width: 100%;
        }

        .btn-add:hover {
            background: #45a049;
        }

        .btn-export {
            background: #2196F3;
            color: white;
        }

        .btn-export:hover {
            background: #0b7dda;
        }

        .btn-print {
            background: #FF9800;
            color: white;
        }

        .btn-print:hover {
            background: #e68900;
        }

        .btn-delete {
            background: #f44336;
            color: white;
            padding: 4px 8px;
            font-size: 11px;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 12px;
        }

        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }

        th {
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .colors-cell {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .color-item {
            width: 100%;
            min-height: 24px;
            border-radius: 3px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            padding: 2px 4px;
            color: #000;
            text-shadow: 0 0 2px #fff, 0 0 2px #fff, 0 0 2px #fff;
        }

        .quantities-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quantity-item {
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .total-row {
            background: #e8f5e9 !important;
            font-weight: bold;
            font-size: 14px;
        }

        .total-row td {
            border-top: 3px solid #4CAF50;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .table-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 4px;
            display: block;
        }
        
        td:has(.table-image) {
            padding: 0;
        }

        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }

            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                padding: 0;
                max-width: 100%;
            }

            .language-switcher {
                display: none !important;
            }

            .form-section, .button-group, .btn-delete {
                display: none !important;
            }

            h1 {
                font-size: 18px;
                margin-bottom: 10px;
            }

            .client-info {
                display: block !important;
                font-size: 16px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 20px;
                padding: 12px;
                border: 2px solid #4CAF50;
                border-radius: 6px;
                background: #f0f9f0;
            }

            table {
                page-break-inside: auto;
                font-size: 10px;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            thead {
                display: table-header-group;
            }

            tfoot {
                display: table-footer-group;
            }

            .table-image {
                width: 50px;
                height: 50px;
            }

            .color-item {
                height: 18px;
                font-size: 9px;
            }

            .quantity-item {
                height: 15px;
                font-size: 9px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .color-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .button-group {
                flex-direction: column;
            }

            .button-group button {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }

        .client-info {
            display: none;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            border: 2px solid #4CAF50;
            border-radius: 6px;
            background: #f0f9f0;
            color: #333;
        }

            table {
                font-size: 10px;
            }

            th, td {
                padding: 4px;
            }

            .table-image {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn active" onclick="changeLanguage('uz')">O'ZB</button>
        <button class="lang-btn" onclick="changeLanguage('ru')">–†–£–°</button>
        <button class="lang-btn" onclick="changeLanguage('en')">ENG</button>
    </div>

    <div class="container">
        <h1 data-lang="title">üìã –ú–ê“≤–°–£–õ–û–¢ –†–é–ô–•–ê–¢–ò</h1>

        <div class="form-section">
            

            <div class="image-upload">
                <label style="margin: 0;">üì∑ Rasm:</label>
                <input type="file" id="imageUpload" accept="image/*">
                <div class="image-preview" id="imagePreview">
                    <span style="font-size: 10px; color: #999;">Rasm</span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>–ú–æ–¥–µ–ª—å –Ω–æ–º–∏:</label>
                    <input type="text" id="modelName" placeholder="–ú–∞—Å–∞–ª–∞–Ω: Bubon">
                </div>
                <div class="form-group">
                    <label>–ù–∞—Ä—Ö–∏ ( $ ):</label>
                    <input type="number" id="modelPrice" placeholder="–ú–∞—Å–∞–ª–∞–Ω: 12$" min="0">
                </div>
            </div>

            <div class="colors-section">
                <label>Ranglar:</label>
                <div class="color-options">
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFD700')">
                        <input type="checkbox" value="tilla">
                        <div class="color-box" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);"></div>
                        <span>–¢–∏–ª–ª–∞ (40686)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFF8DC')">
                        <input type="checkbox" value="qaymoq">
                        <div class="color-box" style="background: #FFF8DC; border: 1px solid #ddd;"></div>
                        <span>Ayviriy (41458)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#808080')">
                        <input type="checkbox" value="seriy">
                        <div class="color-box" style="background: #808080;"></div>
                        <span>“ö–∞–π–º–æ“õ (40823)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#F5E6D3')">
                        <input type="checkbox" value="shampan">
                        <div class="color-box" style="background: #F5E6D3; border: 1px solid #ddd;"></div>
                        <span>–®–∞–º–ø–∞–Ω</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFFFFF')">
                        <input type="checkbox" value="oq">
                        <div class="color-box" style="background: #FFFFFF; border: 1px solid #ddd;"></div>
                        <span>–û“õ (40447)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#A9A9A9')">
                        <input type="checkbox" value="mokriy">
                        <div class="color-box" style="background: #A9A9A9;"></div>
                        <span>–ú–æ–∫—Ä–∏–π (41482)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#000000')">
                        <input type="checkbox" value="qora">
                        <div class="color-box" style="background: #000000;"></div>
                        <span>“ö–æ—Ä–∞</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#8B7355')">
                        <input type="checkbox" value="antik">
                        <div class="color-box" style="background: linear-gradient(135deg, #8B7355 0%, #6B5A44 100%);"></div>
                        <span>–ê–Ω—Ç–∏–∫</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#B87333')">
                        <input type="checkbox" value="mis">
                        <div class="color-box" style="background: linear-gradient(135deg, #B87333 0%, #8B5A2B 100%);"></div>
                        <span>–ú–∏—Å</span>
                    </div>
                     <div class="color-checkbox" onclick="toggleColor(this, '#FFE066')">
                        <input type="checkbox" value="och-tilla">
                        <div class="color-box" style="background: linear-gradient(135deg, #FFE066 0%, #FFDB4D 100%);"></div>
                        <span>–û—á —Ç–∏–ª–ª–∞ (41067)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#D2691E')">
                        <input type="checkbox" value="kofe">
                        <div class="color-box" style="background: #D2691E;"></div>
                        <span>–ö–æ—Ñ–µ (40744)</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#C19A6B')">
                        <input type="checkbox" value="och-kofe">
                        <div class="color-box" style="background: #C19A6B;"></div>
                        <span>–û—á –∫–æ—Ñ–µ (40752)</span>
                    </div>
                </div>
            </div>

            <div class="quantities-section" id="quantitiesSection">
                <label data-lang="quantities-label">Har bir rang uchun soni:</label>
                <div id="quantityInputs"></div>
            </div>

            <button class="btn-add" onclick="addProduct()" data-lang="add-btn">‚ûï Ro'yxatga qo'shish</button>
        </div>

        <div class="button-group">
            <button class="btn-export" onclick="shareList()" style="background: #25D366;" data-lang="share-btn">üì§ –£–ª–∞—à–∏—à (Telegram/WhatsApp)</button>
            <button class="btn-export" onclick="exportToImage()" data-lang="image-btn">üñºÔ∏è –†–∞—Å–º —Å–∞“õ–ª–∞—à</button>
            <button class="btn-export" onclick="exportToPDF()" data-lang="pdf-btn">üìÑ PDF</button>
            <button class="btn-print" onclick="window.print()" data-lang="print-btn">üñ®Ô∏è Print</button>
        </div>

        <table id="productTable">
            <thead>
                
                    <div class="form-group" style="margin-bottom: 15px;">
                <label>üë§ –ú–∏–∂–æ–∑ / –ö–æ–º–ø–∞–Ω–∏—è –Ω–æ–º–∏:</label>
                <input type="text" id="clientName" data-lang="client-placeholder"  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –é–∑–±–µ–∫ –î–∏–∑–∞–π–Ω" style="padding: 12px; font-size: 16px; font-weight: bold;">
            </div>
                
                <tr>
                    <th style="width: 5%;">‚Ññ</th>
                    <th style="width: 25%;" data-lang="th-model">–ú–æ–¥–µ–ª—å</th>
                    <th style="width: 15%;" data-lang="th-image">–†–∞—Å–º</th>
                    <th style="width: 12%;" data-lang="th-color">–†–∞–Ω–≥</th>
                    <th style="width: 10%;" data-lang="th-qty">–°–æ–Ω–∏ (–ñ—É—Ñ—Ç)</th>
                    <th style="width: 13%;" data-lang="th-price">–ù–∞—Ä—Ö–∏</th>
                    <th style="width: 15%;" data-lang="th-total">–ñ–∞–º–∏ —Å—É–º–º–∞ ( $ )</th>
                    <th style="width: 5%;" data-lang="th-action">–∞–º–∞–ª</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="4" class="text-right"><strong data-lang="total-label">JAMI:</strong></td>
                    <td class="text-center" id="totalQty"><strong>0</strong></td>
                    <td></td>
                    <td class="text-right" id="totalPrice"><strong>0</strong></td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const translations = {
            uz: {
                'title': 'üìã MAHSULOT RO\'YXATI',
                'client-label': 'üë§ Mijoz / Kompaniya nomi:',
                'client-placeholder': 'Masalan: Ozbek Dizayn',
                'image-label': 'üì∑ Rasm:',
                'image-text': 'Rasm',
                'model-label': 'Model nomi:',
                'model-placeholder': 'Masalan: Karni–∑ Elite',
                'price-label': 'Narxi (so\'m):',
                'price-placeholder': 'Masalan: 500000',
                'colors-label': 'Ranglar:',
                'color-tilla': 'Tilla',
                'color-och-tilla': 'Och tilla',
                'color-qaymoq': 'Qaymoq',
                'color-och-kofe': 'Och kofe',
                'color-kofe': 'Kofe',
                'color-seriy': 'Seriy',
                'color-shampan': 'Shampan',
                'color-oq': 'Oq',
                'color-mokriy': 'Mokriy',
                'color-qora': 'Qora',
                'color-antik': 'Antik',
                'color-mis': 'Mis',
                'quantities-label': 'Har bir rang uchun soni:',
                'add-btn': '‚ûï Ro\'yxatga qo\'shish',
                'share-btn': 'üì§ Ulashish (Telegram/WhatsApp)',
                'image-btn': 'üñºÔ∏è Rasm saqlash',
                'pdf-btn': 'üìÑ PDF',
                'print-btn': 'üñ®Ô∏è Print',
                'th-model': 'Model',
                'th-image': 'Rasm',
                'th-color': 'Rang',
                'th-qty': 'Soni',
                'th-price': 'Narxi',
                'th-total': 'Jami summa',
                'th-action': 'Amal',
                'total-label': 'JAMI:',
                'alert-model': 'Model nomini kiriting!',
                'alert-colors': 'Kamida bitta rang tanlang!'
            },
            ru: {
                'title': 'üìã –°–ü–ò–°–û–ö –¢–û–í–ê–†–û–í',
                'client-label': 'üë§ –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ / –ö–æ–º–ø–∞–Ω–∏–∏:',
                'client-placeholder': '–ù–∞–ø—Ä–∏–º–µ—Ä: –£–∑–±–µ–∫ –î–∏–∑–∞–π–Ω',
                'image-label': 'üì∑ –§–æ—Ç–æ:',
                'image-text': '–§–æ—Ç–æ',
                'model-label': '–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏:',
                'model-placeholder': '–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ä–Ω–∏–∑ –≠–ª–∏—Ç',
                'price-label': '–¶–µ–Ω–∞ (—Å—É–º):',
                'price-placeholder': '–ù–∞–ø—Ä–∏–º–µ—Ä: 500000',
                'colors-label': '–¶–≤–µ—Ç–∞:',
                'color-tilla': '–ó–æ–ª–æ—Ç–æ',
                'color-och-tilla': '–°–≤–µ—Ç–ª–æ–µ –∑–æ–ª–æ—Ç–æ',
                'color-qaymoq': '–ö—Ä–µ–º',
                'color-och-kofe': '–°–≤–µ—Ç–ª—ã–π –∫–æ—Ñ–µ',
                'color-kofe': '–ö–æ—Ñ–µ',
                'color-seriy': '–°–µ—Ä—ã–π',
                'color-shampan': '–®–∞–º–ø–∞–Ω—å',
                'color-oq': '–ë–µ–ª—ã–π',
                'color-mokriy': '–ú–æ–∫—Ä—ã–π –∞—Å—Ñ–∞–ª—å—Ç',
                'color-qora': '–ß–µ—Ä–Ω—ã–π',
                'color-antik': '–ê–Ω—Ç–∏–∫',
                'color-mis': '–ú–µ–¥—å',
                'quantities-label': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ü–≤–µ—Ç–∞:',
                'add-btn': '‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫',
                'share-btn': 'üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (Telegram/WhatsApp)',
                'image-btn': 'üñºÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —Ñ–æ—Ç–æ',
                'pdf-btn': 'üìÑ PDF',
                'print-btn': 'üñ®Ô∏è –ü–µ—á–∞—Ç—å',
                'th-model': '–ú–æ–¥–µ–ª—å',
                'th-image': '–§–æ—Ç–æ',
                'th-color': '–¶–≤–µ—Ç',
                'th-qty': '–ö–æ–ª-–≤–æ (–ø–∞—Ä–∞)',
                'th-price': '–¶–µ–Ω–∞',
                'th-total': '–ò—Ç–æ–≥–æ',
                'th-action': '–î–µ–π—Å—Ç–≤–∏–µ',
                'total-label': '–ò–¢–û–ì–û:',
                'alert-model': '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏!',
                'alert-colors': '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ü–≤–µ—Ç!'
            },
            en: {
                'title': 'üìã PRODUCT LIST',
                'client-label': 'üë§ Client / Company Name:',
                'client-placeholder': 'Example: Uzbek Design',
                'image-label': 'üì∑ Image:',
                'image-text': 'Image',
                'model-label': 'Model Name:',
                'model-placeholder': 'Example: Curtain Rod Elite',
                'price-label': 'Price (UZS):',
                'price-placeholder': 'Example: 500000',
                'colors-label': 'Colors:',
                'color-tilla': 'Gold',
                'color-och-tilla': 'Light Gold',
                'color-qaymoq': 'Cream',
                'color-och-kofe': 'Light Coffee',
                'color-kofe': 'Coffee',
                'color-seriy': 'Gray',
                'color-shampan': 'Champagne',
                'color-oq': 'White',
                'color-mokriy': 'Wet Asphalt',
                'color-qora': 'Black',
                'color-antik': 'Antique',
                'color-mis': 'Copper',
                'quantities-label': 'Quantity for each color:',
                'add-btn': '‚ûï Add to List',
                'share-btn': 'üì§ Share (Telegram/WhatsApp)',
                'image-btn': 'üñºÔ∏è Save as Image',
                'pdf-btn': 'üìÑ PDF',
                'print-btn': 'üñ®Ô∏è Print',
                'th-model': 'Model',
                'th-image': 'Image',
                'th-color': 'Color',
                'th-qty': 'Quantity (pair)',
                'th-price': 'Price',
                'th-total': 'Total',
                'th-action': 'Action',
                'total-label': 'TOTAL:',
                'alert-model': 'Enter model name!',
                'alert-colors': 'Select at least one color!'
            }
        };

        let currentLang = 'uz';
        let selectedColors = [];
        let uploadedImage = '';

        function changeLanguage(lang) {
            currentLang = lang;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });

            updateQuantityInputs();
        }

        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImage = event.target.result;
                    document.getElementById('imagePreview').innerHTML = `<img src="${uploadedImage}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('clientName').addEventListener('input', function(e) {
            const clientName = e.target.value.trim();
            const clientInfo = document.getElementById('clientInfo');
            if (clientName) {
                clientInfo.textContent = `üë§ ${clientName}`;
            } else {
                clientInfo.textContent = '';
            }
        });

        function toggleColor(element, colorCode) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const colorName = checkbox.value;
            
            if (checkbox.checked) {
                checkbox.checked = false;
                element.classList.remove('selected');
                selectedColors = selectedColors.filter(c => c.name !== colorName);
            } else {
                checkbox.checked = true;
                element.classList.add('selected');
                selectedColors.push({ name: colorName, code: colorCode });
            }

            updateQuantityInputs();
        }

        function updateQuantityInputs() {
            const section = document.getElementById('quantitiesSection');
            const container = document.getElementById('quantityInputs');
            
            if (selectedColors.length > 0) {
                section.classList.add('active');
                container.innerHTML = selectedColors.map(color => `
                    <div class="quantity-input">
                        <div class="color-indicator" style="background: ${color.code};"></div>
                        <input type="number" id="qty_${color.name}" placeholder="${color.name} soni" min="1" value="1">
                    </div>
                `).join('');
            } else {
                section.classList.remove('active');
                container.innerHTML = '';
            }
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function addProduct() {
            const modelName = document.getElementById('modelName').value.trim();
            const price = parseInt(document.getElementById('modelPrice').value) || 0;

            if (!modelName) {
                alert(translations[currentLang]['alert-model']);
                return;
            }

            if (selectedColors.length === 0) {
                alert(translations[currentLang]['alert-colors']);
                return;
            }

            const quantities = selectedColors.map(color => {
                const qty = parseInt(document.getElementById(`qty_${color.name}`).value) || 1;
                return { color: color, qty: qty };
            });

            const tbody = document.getElementById('tableBody');
            const rowCount = tbody.rows.length + 1;
            
            const totalQty = quantities.reduce((sum, item) => sum + item.qty, 0);
            const totalSum = totalQty * price;

            const colorsHTML = quantities.map(item => 
                `<div class="color-item" style="background: ${item.color.code};">${item.color.name}</div>`
            ).join('');

            const quantitiesHTML = quantities.map(item => 
                `<div class="quantity-item">${item.qty}</div>`
            ).join('');

            const imageURL = uploadedImage || 'https://via.placeholder.com/80?text=No+Image';

            const row = tbody.insertRow();
            row.innerHTML = `
                <td class="text-center">${rowCount}</td>
                <td>${modelName}</td>
                <td style="padding: 0;"><img src="${imageURL}" alt="${modelName}" class="table-image"></td>
                <td><div class="colors-cell">${colorsHTML}</div></td>
                <td><div class="quantities-cell">${quantitiesHTML}</div></td>
                <td class="text-right">${price > 0 ? formatNumber(price) : '0'}</td>
                <td class="text-right">${totalSum > 0 ? formatNumber(totalSum) : '0'}</td>
                <td class="text-center"><button class="btn-delete" onclick="deleteRow(this)">‚ùå</button></td>
            `;

            resetForm();
            updateTotals();
        }

        function resetForm() {
            document.getElementById('modelName').value = '';
            document.getElementById('modelPrice').value = '';
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').innerHTML = '<span style="font-size: 10px; color: #999;">Rasm</span>';
            uploadedImage = '';

            document.querySelectorAll('.color-checkbox').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('input[type="checkbox"]').checked = false;
            });

            selectedColors = [];
            updateQuantityInputs();
        }

        function deleteRow(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateRowNumbers();
            updateTotals();
        }

        function updateRowNumbers() {
            const tbody = document.getElementById('tableBody');
            for (let i = 0; i < tbody.rows.length; i++) {
                tbody.rows[i].cells[0].textContent = i + 1;
            }
        }

        function updateTotals() {
            const tbody = document.getElementById('tableBody');
            let totalQty = 0;
            let totalPrice = 0;

            for (let i = 0; i < tbody.rows.length; i++) {
                const quantitiesCell = tbody.rows[i].cells[4];
                const quantities = quantitiesCell.querySelectorAll('.quantity-item');
                quantities.forEach(q => {
                    totalQty += parseInt(q.textContent) || 0;
                });

                const total = parseInt(tbody.rows[i].cells[6].textContent.replace(/,/g, '')) || 0;
                totalPrice += total;
            }

            document.getElementById('totalQty').innerHTML = `<strong>${totalQty}</strong>`;
            document.getElementById('totalPrice').innerHTML = `<strong>${formatNumber(totalPrice)}</strong>`;
        }

        function exportToPDF() {
            const clientName = document.getElementById('clientName').value.trim();
            const fileName = clientName ? `${clientName}-royxat.pdf` : 'mahsulot-royxati.pdf';
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const pageHeight = 277;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 10;

                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 10;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                doc.save(fileName);
                
                buttons.style.display = 'flex';
                form.style.display = 'block';
            });
        }

        function exportToImage() {
            const clientName = document.getElementById('clientName').value.trim();
            const fileName = clientName ? `${clientName}-royxat.png` : 'mahsulot-royxati.png';
            
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 3,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    buttons.style.display = 'flex';
                    form.style.display = 'block';
                }, 'image/png');
            });
        }

        function shareList() {
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 3,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    if (navigator.share) {
                        const file = new File([blob], 'mahsulot-royxati.png', { type: 'image/png' });
                        navigator.share({
                            title: 'Mahsulot Ro\'yxati',
                            text: 'Mahsulot ro\'yxatim',
                            files: [file]
                        }).then(() => {
                            console.log('Muvaffaqiyatli ulashildi');
                        }).catch(err => {
                            console.log('Ulashish bekor qilindi', err);
                        });
                    } else {
                        alert('Sizning brauzeringiz ulashishni qo\'llab-quvvatlamaydi');
                    }
                    
                    buttons.style.display = 'flex';
                    form.style.display = 'block';
                }, 'image/png');
            });
        }
    </script>
</body>
</html>
