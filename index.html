<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahsulot Ro'yxati</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 12px;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        input[type="text"], input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .image-upload {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .image-upload input[type="file"] {
            flex: 1;
        }

        .image-preview {
            width: 60px;
            height: 60px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .colors-section {
            margin-bottom: 10px;
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .color-checkbox {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-checkbox:hover {
            border-color: #4CAF50;
        }

        .color-checkbox input[type="checkbox"] {
            margin-right: 8px;
        }

        .color-checkbox.selected {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }

        .quantities-section {
            display: none;
            margin-top: 10px;
        }

        .quantities-section.active {
            display: block;
        }

        .quantity-input {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .quantity-input .color-indicator {
            width: 25px;
            height: 25px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }

        .quantity-input input {
            flex: 1;
            padding: 6px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-add {
            background: #4CAF50;
            color: white;
            width: 100%;
        }

        .btn-add:hover {
            background: #45a049;
        }

        .btn-export {
            background: #2196F3;
            color: white;
        }

        .btn-export:hover {
            background: #0b7dda;
        }

        .btn-print {
            background: #FF9800;
            color: white;
        }

        .btn-print:hover {
            background: #e68900;
        }

        .btn-delete {
            background: #f44336;
            color: white;
            padding: 4px 8px;
            font-size: 11px;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 12px;
        }

        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }

        th {
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .colors-cell {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .color-item {
            width: 100%;
            min-height: 24px;
            border-radius: 3px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            padding: 2px 4px;
            color: #000;
            text-shadow: 0 0 2px #fff, 0 0 2px #fff, 0 0 2px #fff;
        }

        .quantities-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quantity-item {
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .total-row {
            background: #e8f5e9 !important;
            font-weight: bold;
            font-size: 14px;
        }

        .total-row td {
            border-top: 3px solid #4CAF50;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .table-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 4px;
            display: block;
        }
        
        td:has(.table-image) {
            padding: 0;
        }

        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }

            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                padding: 0;
                max-width: 100%;
            }

            .form-section, .button-group, .btn-delete {
                display: none !important;
            }

            h1 {
                font-size: 18px;
                margin-bottom: 10px;
            }

            table {
                page-break-inside: auto;
                font-size: 10px;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            thead {
                display: table-header-group;
            }

            tfoot {
                display: table-footer-group;
            }

            .table-image {
                width: 50px;
                height: 50px;
            }

            .color-item {
                height: 18px;
                font-size: 9px;
            }

            .quantity-item {
                height: 15px;
                font-size: 9px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .color-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .button-group {
                flex-direction: column;
            }

            .button-group button {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }

            table {
                font-size: 10px;
            }

            th, td {
                padding: 4px;
            }

            .table-image {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã MAHSULOT RO'YXATI</h1>

        <div class="form-section">
            <div class="image-upload">
                <label style="margin: 0;">üì∑ Rasm:</label>
                <input type="file" id="imageUpload" accept="image/*">
                <div class="image-preview" id="imagePreview">
                    <span style="font-size: 10px; color: #999;">Rasm</span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Model nomi:</label>
                    <input type="text" id="modelName" placeholder="Masalan: Bubon">
                </div>
                <div class="form-group">
                    <label>Narxi ( $ ):</label>
                    <input type="number" id="modelPrice" placeholder="Masalan: 12$">
                </div>
            </div>

            <div class="colors-section">
                <label>Ranglar:</label>
                <div class="color-options">
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFD700')">
                        <input type="checkbox" value="tilla">
                        <div class="color-box" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);"></div>
                        <span>Tilla</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFF8DC')">
                        <input type="checkbox" value="qaymoq">
                        <div class="color-box" style="background: #FFF8DC; border: 1px solid #ddd;"></div>
                        <span>Qaymoq</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#808080')">
                        <input type="checkbox" value="seriy">
                        <div class="color-box" style="background: #808080;"></div>
                        <span>Seriy</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#F5E6D3')">
                        <input type="checkbox" value="shampan">
                        <div class="color-box" style="background: #F5E6D3; border: 1px solid #ddd;"></div>
                        <span>Shampan</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#FFFFFF')">
                        <input type="checkbox" value="oq">
                        <div class="color-box" style="background: #FFFFFF; border: 1px solid #ddd;"></div>
                        <span>Oq</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#A9A9A9')">
                        <input type="checkbox" value="mokriy">
                        <div class="color-box" style="background: #A9A9A9;"></div>
                        <span>Mokriy</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#000000')">
                        <input type="checkbox" value="qora">
                        <div class="color-box" style="background: #000000;"></div>
                        <span>Qora</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#8B7355')">
                        <input type="checkbox" value="antik">
                        <div class="color-box" style="background: linear-gradient(135deg, #8B7355 0%, #6B5A44 100%);"></div>
                        <span>Antik</span>
                    </div>
                    <div class="color-checkbox" onclick="toggleColor(this, '#B87333')">
                        <input type="checkbox" value="mis">
                        <div class="color-box" style="background: linear-gradient(135deg, #B87333 0%, #8B5A2B 100%);"></div>
                        <span>Mis</span>
                    </div>
                </div>
            </div>

            <div class="quantities-section" id="quantitiesSection">
                <label>Har bir rang uchun soni:</label>
                <div id="quantityInputs"></div>
            </div>

            <button class="btn-add" onclick="addProduct()">‚ûï Ro'yxatga qo'shish</button>
        </div>

        <div class="button-group">
            <button class="btn-export" onclick="shareList()" style="background: #25D366;">üì§ Ulashish (Telegram/WhatsApp)</button>
            <button class="btn-export" onclick="exportToImage()">üñºÔ∏è Rasm saqlash</button>
            <button class="btn-export" onclick="exportToPDF()">üìÑ PDF</button>
            <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
        </div>

        <table id="productTable">
            <thead>
                <tr>
                    <th style="width: 5%;">‚Ññ</th>
                    <th style="width: 15%;">Rasm</th>
                    <th style="width: 25%;">Model</th>
                    <th style="width: 12%;">Rang</th>
                    <th style="width: 10%;">Soni</th>
                    <th style="width: 13%;">Narxi $</th>
                    <th style="width: 15%;">Jami summa</th>
                    <th style="width: 5%;">Amal</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="4" class="text-right"><strong>JAMI:</strong></td>
                    <td class="text-center" id="totalQty"><strong>0</strong></td>
                    <td></td>
                    <td class="text-right" id="totalPrice"><strong>0</strong></td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        let selectedColors = [];
        let uploadedImage = '';

        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImage = event.target.result;
                    document.getElementById('imagePreview').innerHTML = `<img src="${uploadedImage}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        function toggleColor(element, colorCode) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const colorName = checkbox.value;
            
            if (checkbox.checked) {
                checkbox.checked = false;
                element.classList.remove('selected');
                selectedColors = selectedColors.filter(c => c.name !== colorName);
            } else {
                checkbox.checked = true;
                element.classList.add('selected');
                selectedColors.push({ name: colorName, code: colorCode });
            }

            updateQuantityInputs();
        }

        function updateQuantityInputs() {
            const section = document.getElementById('quantitiesSection');
            const container = document.getElementById('quantityInputs');
            
            if (selectedColors.length > 0) {
                section.classList.add('active');
                container.innerHTML = selectedColors.map(color => `
                    <div class="quantity-input">
                        <div class="color-indicator" style="background: ${color.code};"></div>
                        <input type="number" id="qty_${color.name}" placeholder="${color.name} soni" min="1" value="1">
                    </div>
                `).join('');
            } else {
                section.classList.remove('active');
                container.innerHTML = '';
            }
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function addProduct() {
            const modelName = document.getElementById('modelName').value.trim();
            const price = parseInt(document.getElementById('modelPrice').value) || 0;

            if (!modelName) {
                alert('Model nomini kiriting!');
                return;
            }

            if (price <= 0) {
                alert('Narxni kiriting!');
                return;
            }

            if (selectedColors.length === 0) {
                alert('Kamida bitta rang tanlang!');
                return;
            }

            const quantities = selectedColors.map(color => {
                const qty = parseInt(document.getElementById(`qty_${color.name}`).value) || 1;
                return { color: color, qty: qty };
            });

            const tbody = document.getElementById('tableBody');
            const rowCount = tbody.rows.length + 1;
            
            const totalQty = quantities.reduce((sum, item) => sum + item.qty, 0);
            const totalSum = totalQty * price;

            const colorsHTML = quantities.map(item => 
                `<div class="color-item" style="background: ${item.color.code};">${item.color.name}</div>`
            ).join('');

            const quantitiesHTML = quantities.map(item => 
                `<div class="quantity-item">${item.qty}</div>`
            ).join('');

            const imageURL = uploadedImage || 'https://via.placeholder.com/80?text=No+Image';

            const row = tbody.insertRow();
            row.innerHTML = `
                <td class="text-center">${rowCount}</td>
                <td style="padding: 0;"><img src="${imageURL}" alt="${modelName}" class="table-image"></td>
                <td>${modelName}</td>
                <td><div class="colors-cell">${colorsHTML}</div></td>
                <td><div class="quantities-cell">${quantitiesHTML}</div></td>
                <td class="text-right">${formatNumber(price)}</td>
                <td class="text-right">${formatNumber(totalSum)}</td>
                <td class="text-center"><button class="btn-delete" onclick="deleteRow(this)">‚ùå</button></td>
            `;

            resetForm();
            updateTotals();
        }

        function resetForm() {
            document.getElementById('modelName').value = '';
            document.getElementById('modelPrice').value = '';
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').innerHTML = '<span style="font-size: 10px; color: #999;">Rasm</span>';
            uploadedImage = '';

            document.querySelectorAll('.color-checkbox').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('input[type="checkbox"]').checked = false;
            });

            selectedColors = [];
            updateQuantityInputs();
        }

        function deleteRow(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateRowNumbers();
            updateTotals();
        }

        function updateRowNumbers() {
            const tbody = document.getElementById('tableBody');
            for (let i = 0; i < tbody.rows.length; i++) {
                tbody.rows[i].cells[0].textContent = i + 1;
            }
        }

        function updateTotals() {
            const tbody = document.getElementById('tableBody');
            let totalQty = 0;
            let totalPrice = 0;

            for (let i = 0; i < tbody.rows.length; i++) {
                const quantitiesCell = tbody.rows[i].cells[4];
                const quantities = quantitiesCell.querySelectorAll('.quantity-item');
                quantities.forEach(q => {
                    totalQty += parseInt(q.textContent) || 0;
                });

                const total = parseInt(tbody.rows[i].cells[6].textContent.replace(/,/g, '')) || 0;
                totalPrice += total;
            }

            document.getElementById('totalQty').innerHTML = `<strong>${totalQty}</strong>`;
            document.getElementById('totalPrice').innerHTML = `<strong>${formatNumber(totalPrice)}</strong>`;
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const pageHeight = 277;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 10;

                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 10;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                doc.save('mahsulot-royxati.pdf');
                
                buttons.style.display = 'flex';
                form.style.display = 'block';
            });
        }

        function exportToImage() {
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 3,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'mahsulot-royxati.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    buttons.style.display = 'flex';
                    form.style.display = 'block';
                }, 'image/png');
            });
        }

        function shareList() {
            const element = document.querySelector('.container');
            const buttons = document.querySelector('.button-group');
            const form = document.querySelector('.form-section');
            
            buttons.style.display = 'none';
            form.style.display = 'none';

            html2canvas(element, {
                scale: 3,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    if (navigator.share) {
                        const file = new File([blob], 'mahsulot-royxati.png', { type: 'image/png' });
                        navigator.share({
                            title: 'Mahsulot Ro\'yxati',
                            text: 'Mahsulot ro\'yxatim',
                            files: [file]
                        }).then(() => {
                            console.log('Muvaffaqiyatli ulashildi');
                        }).catch(err => {
                            console.log('Ulashish bekor qilindi', err);
                        });
                    } else {
                        alert('Sizning brauzeringiz ulashishni qo\'llab-quvvatlamaydi');
                    }
                    
                    buttons.style.display = 'flex';
                    form.style.display = 'block';
                }, 'image/png');
            });
        }
    </script>
</body>
</html>
